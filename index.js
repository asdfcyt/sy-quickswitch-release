"use strict";var Ft=Object.defineProperty;var Kt=(n,e,t)=>e in n?Ft(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var H=(n,e,t)=>Kt(n,typeof e!="symbol"?e+"":e,t);const Ht=require("siyuan");function he(){}function Nt(n){return n()}function et(){return Object.create(null)}function ee(n){n.forEach(Nt)}function It(n){return typeof n=="function"}function Dt(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function Qt(n){return Object.keys(n).length===0}function r(n,e){n.appendChild(e)}function N(n,e,t){n.insertBefore(e,t||null)}function C(n){n.parentNode&&n.parentNode.removeChild(n)}function Ue(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function h(n){return document.createElement(n)}function xt(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function O(n){return document.createTextNode(n)}function v(){return O(" ")}function Ie(){return O("")}function L(n,e,t,s){return n.addEventListener(e,t,s),()=>n.removeEventListener(e,t,s)}function d(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function Bt(n){let e;return{p(...t){e=t,e.forEach(s=>n.push(s))},r(){e.forEach(t=>n.splice(n.indexOf(t),1))}}}function Ot(n){return n===""?null:+n}function Jt(n){return Array.from(n.childNodes)}function B(n,e){e=""+e,n.data!==e&&(n.data=e)}function G(n,e){n.value=e??""}function Ge(n,e,t){for(let s=0;s<n.options.length;s+=1){const o=n.options[s];if(o.__value===e){o.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function tt(n){const e=n.querySelector(":checked");return e&&e.__value}function Z(n,e,t){n.classList.toggle(e,!!t)}class Gt{constructor(e=!1){H(this,"is_svg",!1);H(this,"e");H(this,"n");H(this,"t");H(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,s=null){this.e||(this.is_svg?this.e=xt(t.nodeName):this.e=h(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(s)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)N(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(C)}}let je;function Re(n){je=n}function Mt(){if(!je)throw new Error("Function called outside component initialization");return je}function Lt(n){Mt().$$.on_mount.push(n)}function Ut(n){Mt().$$.on_destroy.push(n)}const Ce=[],Xe=[];let Ne=[];const nt=[],zt=Promise.resolve();let Ze=!1;function Yt(){Ze||(Ze=!0,zt.then(At))}function Fe(n){Ne.push(n)}const Ve=new Set;let Te=0;function At(){if(Te!==0)return;const n=je;do{try{for(;Te<Ce.length;){const e=Ce[Te];Te++,Re(e),Wt(e.$$)}}catch(e){throw Ce.length=0,Te=0,e}for(Re(null),Ce.length=0,Te=0;Xe.length;)Xe.pop()();for(let e=0;e<Ne.length;e+=1){const t=Ne[e];Ve.has(t)||(Ve.add(t),t())}Ne.length=0}while(Ce.length);for(;nt.length;)nt.pop()();Ze=!1,Ve.clear(),Re(n)}function Wt(n){if(n.fragment!==null){n.update(),ee(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(Fe)}}function Vt(n){const e=[],t=[];Ne.forEach(s=>n.indexOf(s)===-1?e.push(s):t.push(s)),t.forEach(s=>s()),Ne=e}const Xt=new Set;function Zt(n,e){n&&n.i&&(Xt.delete(n),n.i(e))}function fe(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function $t(n,e,t){const{fragment:s,after_update:o}=n.$$;s&&s.m(e,t),Fe(()=>{const i=n.$$.on_mount.map(Nt).filter(It);n.$$.on_destroy?n.$$.on_destroy.push(...i):ee(i),n.$$.on_mount=[]}),o.forEach(Fe)}function en(n,e){const t=n.$$;t.fragment!==null&&(Vt(t.after_update),ee(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function tn(n,e){n.$$.dirty[0]===-1&&(Ce.push(n),Yt(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function Pt(n,e,t,s,o,i,l=null,c=[-1]){const u=je;Re(n);const a=n.$$={fragment:null,ctx:[],props:i,update:he,not_equal:o,bound:et(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:et(),dirty:c,skip_bound:!1,root:e.target||u.$$.root};l&&l(a.root);let p=!1;if(a.ctx=t?t(n,e.props||{},(_,k,...w)=>{const y=w.length?w[0]:k;return a.ctx&&o(a.ctx[_],a.ctx[_]=y)&&(!a.skip_bound&&a.bound[_]&&a.bound[_](y),p&&tn(n,_)),k}):[],a.update(),p=!0,ee(a.before_update),a.fragment=s?s(a.ctx):!1,e.target){if(e.hydrate){const _=Jt(e.target);a.fragment&&a.fragment.l(_),_.forEach(C)}else a.fragment&&a.fragment.c();e.intro&&Zt(n.$$.fragment),$t(n,e.target,e.anchor),At()}Re(u)}class Rt{constructor(){H(this,"$$");H(this,"$$set")}$destroy(){en(this,1),this.$destroy=he}$on(e,t){if(!It(t))return he;const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(t),()=>{const o=s.indexOf(t);o!==-1&&s.splice(o,1)}}$set(e){this.$$set&&!Qt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const nn="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(nn);class jt{constructor(e){H(this,"plugin");this.plugin=e}async getNotebooks(){try{const e=await fetch("/api/notebook/lsNotebooks",{method:"POST"});if(!e.ok)return console.error("Failed to fetch notebooks:",e.statusText),[];const t=await e.json();return t.code===0&&t.data&&t.data.notebooks?t.data.notebooks.map(s=>({id:s.id,name:s.name,icon:s.icon,closed:s.closed})):[]}catch(e){return console.error("Error fetching notebooks:",e),[]}}async searchDocs(e){const{keyword:t,notebook:s,limit:o=50}=e;if(!t.trim())return[];try{let i=`
        SELECT DISTINCT id, content, hpath, box, ial, updated
        FROM blocks
        WHERE type = 'd'
        AND (
          content LIKE '%${t}%'
          OR hpath LIKE '%${t}%'
        )
      `;s&&(i+=` AND box = '${s}'`),i+=` ORDER BY updated DESC LIMIT ${o}`;const l=await fetch("/api/query/sql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({stmt:i})});if(!l.ok)return console.error("搜索请求失败:",l.statusText),[];const c=await l.json();return c.code===0&&c.data&&Array.isArray(c.data)?c.data.map(a=>{let p="📄";if(a.ial){const k=a.ial.match(/icon="([^"]+)"/);k&&(p=k[1])}return{id:a.id,name:a.content||"未命名",path:a.hpath||"",notebook:a.box||"",notebookName:"",icon:p,updated:a.updated}}):[]}catch(i){return console.error("❌ 搜索文档时发生错误:",i),[]}}getOpenedTabs(){try{const e=[];return document.querySelectorAll(".layout-tab-bar .item").forEach(i=>{var u;const l=i.getAttribute("data-id"),c=i.getAttribute("data-title")||i.getAttribute("title")||((u=i.textContent)==null?void 0:u.trim());l&&e.push({id:l,title:c||"未命名",docId:l,rootId:l})}),document.querySelectorAll(".protyle:not(.fn__none)").forEach(i=>{var a;const l=i.getAttribute("data-node-id"),c=i.querySelector(".protyle-title"),u=(a=c==null?void 0:c.textContent)==null?void 0:a.trim();l&&!e.find(p=>p.docId===l)&&e.push({id:l,title:u||"未命名",docId:l,rootId:l})}),Array.from(new Map(e.map(i=>[i.docId,i])).values()).filter(i=>i.docId&&i.docId.length>0)}catch(e){return console.error("Error getting opened tabs:",e),console.error("Error stack:",e.stack),[]}}getOpenedDocIds(){const e=this.getOpenedTabs(),t=new Set;return e.forEach(s=>{s.rootId&&t.add(s.rootId),s.docId&&t.add(s.docId)}),t}async openDoc(e,t=!0){try{if(this.plugin&&typeof this.plugin.openTab=="function")try{this.plugin.openTab({app:this.plugin.app,doc:{id:e,action:["cb-get-focus"],zoomIn:!1}});return}catch{}const s=document.querySelector(`.layout-tab-bar .item[data-id="${e}"]`);if(s){s.click();return}const o=`siyuan://blocks/${e}`,i=document.createElement("iframe");i.style.display="none",i.src=o,document.body.appendChild(i),setTimeout(()=>{document.body.removeChild(i)},100);return}catch(s){console.error("打开文档时发生错误:",s);try{const o=window;if(o.siyuan&&o.siyuan.ws&&o.siyuan.ws.app){const i=o.siyuan.ws.app;if(i.workspace&&typeof i.workspace.openDoc=="function"){i.workspace.openDoc(e);return}}}catch{}throw s}}async getDocInfo(e){try{const s=await(await fetch("/api/block/getBlockInfo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})})).json();if(s.code===0&&s.data)return{id:s.data.id,name:s.data.rootTitle||s.data.name,path:s.data.path||"",notebook:s.data.box,icon:s.data.icon||"📄"}}catch(t){console.error("Error getting doc info:",t)}return null}async getOpenedDocuments(){return this.getOpenedTabs().filter(s=>s.rootId||s.docId).map(s=>({id:s.rootId||s.docId||"",name:s.title||"未命名",path:"",notebook:"",isOpened:!0}))}async createDocument(e,t,s){try{const o=await fetch("/api/filetree/createDocWithMd",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notebook:e,path:t,markdown:""})});if(!o.ok)return console.error("创建文档请求失败:",o.statusText),null;const i=await o.json();return i.code===0&&i.data?i.data:null}catch(o){return console.error("❌ 创建文档时发生错误:",o),null}}async insertToDiary(e,t){try{const s=new Date,i=`**${`${String(s.getHours()).padStart(2,"0")}:${String(s.getMinutes()).padStart(2,"0")}`}** ${e}`;let l=t;if(!l){const p=(await this.getNotebooks()).find(_=>!_.closed);if(!p)return console.error("没有找到打开的笔记本"),!1;l=p.id}const u=await(await fetch("/api/block/appendDailyNoteBlock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataType:"markdown",data:i,notebook:l})})).json();return u.code===0?!0:(console.error("插入日记失败:",u),!1)}catch(s){return console.error("插入日记异常:",s),!1}}}function st(n,e){if(!n||!e)return 0;if(n=n.toLowerCase(),e=e.toLowerCase(),n===e)return 1e3;if(n.startsWith(e))return 900;if(n.includes(e))return 800;let t=0,s=0,o=-1;for(let i=0;i<n.length&&s<e.length;i++)n[i]===e[s]&&(o===i-1?t+=10:t+=5,o=i,s++);return s<e.length&&(t=t*(s/e.length)),t}function sn(n,e,t){if(!n||n.length===0)return[];if(!e.trim())return n.filter(i=>i.isOpened||t.has(i.id)).map(i=>({...i,isOpened:!0}));const o=n.map(i=>({...i,isOpened:i.isOpened||t.has(i.id)})).map(i=>{let l=0;if(i.name){const c=st(i.name,e);l+=c*2}if(i.path){const c=st(i.path,e);l+=c}if(i.updated){const c=(Date.now()-i.updated*1e3)/864e5;c<1?l+=50:c<7?l+=20:c<30&&(l+=10)}return i.isOpened&&l>0&&(l+=1e4),{doc:i,score:l}}).filter(i=>i.score>0);return o.sort((i,l)=>l.score-i.score),o.map(i=>i.doc)}function ze(n,e){if(!e.trim())return n;const t=e.toLowerCase(),s=n.toLowerCase();let o="",i=0,l=0;for(let c=0;c<n.length&&l<e.length;c++)s[c]===t[l]&&(c>i&&(o+=n.substring(i,c)),o+=`<mark>${n[c]}</mark>`,i=c+1,l++);return i<n.length&&(o+=n.substring(i)),o||n}class on{constructor(e){H(this,"TASK_PLUGIN_NAME","siyuan-plugin-task-note-management");H(this,"STORAGE_KEY","reminder.json")}async createQuickReminder(e,t="none"){try{const s=this.generateId(),o=new Date,i=this.formatDate(o),l=o.toISOString(),c={id:s,blockId:null,docId:null,title:e.trim(),date:i,completed:!1,priority:t,createdAt:l,isQuickReminder:!0},u=await this.loadTaskPluginStorage();return u[s]=c,await this.saveTaskPluginStorage(u)?s:null}catch(s){return console.error("创建快速提醒失败:",s),null}}generateId(){const e=Date.now(),t=Math.random().toString(36).substr(2,9);return`quick_${e}_${t}`}formatDate(e){const t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${o}`}async loadTaskPluginStorage(){try{const e=`/data/storage/petal/${this.TASK_PLUGIN_NAME}/${this.STORAGE_KEY}`,s=await(await fetch("/api/file/getFile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e})})).json();if(s.code===0&&s.data)try{const o=atob(s.data);return JSON.parse(o)}catch{return{}}else if(typeof s=="object"&&s!==null&&!s.code)return s;return{}}catch(e){return console.error("读取任务管理插件存储失败:",e),{}}}async saveTaskPluginStorage(e){try{const t=`/data/storage/petal/${this.TASK_PLUGIN_NAME}/${this.STORAGE_KEY}`,s=JSON.stringify(e,null,2),o=`/data/storage/petal/${this.TASK_PLUGIN_NAME}`;await this.ensureDirectoryExists(o);const i=new FormData;i.append("path",t),i.append("isDir","false");const l=new Blob([s],{type:"application/json"});return i.append("file",l,this.STORAGE_KEY),(await(await fetch("/api/file/putFile",{method:"POST",body:i})).json()).code===0}catch(t){return console.error("保存任务管理插件存储异常:",t),!1}}async ensureDirectoryExists(e){try{if((await(await fetch("/api/file/readDir",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e})})).json()).code===0)return!0;const o=new FormData;return o.append("path",e),o.append("isDir","true"),(await(await fetch("/api/file/putFile",{method:"POST",body:o})).json()).code===0}catch(t){return console.error("检查/创建目录失败:",t),!1}}getPriorityEmoji(e){return{none:"⚪",low:"🟢",medium:"🟡",high:"🟠",urgent:"🔴"}[e]||"⚪"}getPriorityLabel(e){return{none:"无",low:"低",medium:"中",high:"高",urgent:"紧急"}[e]||"无"}}function ot(n,e,t){const s=n.slice();s[47]=e[t],s[50]=t;const o=s[0].trim()?s[50]+1:s[50];return s[48]=o,s}function it(n){let e;return{c(){e=h("div"),e.innerHTML='<span class="loading-icon svelte-17guwog">⟳</span>',d(e,"class","quick-switcher__loading svelte-17guwog")},m(t,s){N(t,e,s)},d(t){t&&C(e)}}}function lt(n){let e,t=n[6]+1+"",s,o,i;return{c(){e=h("div"),s=O(t),o=O(" / "),i=O(n[7]),d(e,"class","quick-switcher__match-count svelte-17guwog")},m(l,c){N(l,e,c),r(e,s),r(e,o),r(e,i)},p(l,c){c[0]&64&&t!==(t=l[6]+1+"")&&B(s,t),c[0]&128&&B(i,l[7])},d(l){l&&C(e)}}}function ct(n){let e,t,s,o;function i(_,k){return k[0]&3&&(t=null),t==null&&(t=!!(_[0].trim()&&_[1].length===0)),t?rn:_[1].length===0?cn:ln}let l=i(n,[-1,-1]),c=l(n);function u(_,k){return _[5]?un:an}let a=u(n),p=a(n);return{c(){e=h("div"),c.c(),s=v(),o=h("div"),p.c(),d(e,"class","quick-switcher__results svelte-17guwog"),d(o,"class","quick-switcher__footer svelte-17guwog")},m(_,k){N(_,e,k),c.m(e,null),N(_,s,k),N(_,o,k),p.m(o,null)},p(_,k){l===(l=i(_,k))&&c?c.p(_,k):(c.d(1),c=l(_),c&&(c.c(),c.m(e,null))),a===(a=u(_))&&p?p.p(_,k):(p.d(1),p=a(_),p&&(p.c(),p.m(o,null)))},d(_){_&&(C(e),C(s),C(o)),c.d(),p.d()}}}function ln(n){let e=n[0].trim(),t,s,o=e&&rt(n),i=fe(n[1]),l=[];for(let c=0;c<i.length;c+=1)l[c]=dt(ot(n,i,c));return{c(){o&&o.c(),t=v();for(let c=0;c<l.length;c+=1)l[c].c();s=Ie()},m(c,u){o&&o.m(c,u),N(c,t,u);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(c,u);N(c,s,u)},p(c,u){if(u[0]&1&&(e=c[0].trim()),e?o?o.p(c,u):(o=rt(c),o.c(),o.m(t.parentNode,t)):o&&(o.d(1),o=null),u[0]&1543){i=fe(c[1]);let a;for(a=0;a<i.length;a+=1){const p=ot(c,i,a);l[a]?l[a].p(p,u):(l[a]=dt(p),l[a].c(),l[a].m(s.parentNode,s))}for(;a<l.length;a+=1)l[a].d(1);l.length=i.length}},d(c){c&&(C(t),C(s)),o&&o.d(c),Ue(l,c)}}}function cn(n){let e;return{c(){e=h("div"),e.innerHTML="<span>没有已打开的标签页</span>",d(e,"class","quick-switcher__empty svelte-17guwog")},m(t,s){N(t,e,s)},p:he,d(t){t&&C(e)}}}function rn(n){let e,t,s,o,i,l,c,u,a,p,_,k,w;return{c(){e=h("div"),t=h("div"),t.textContent="✨",s=v(),o=h("div"),i=h("div"),l=O('按下回车以创建 "'),c=h("strong"),u=O(n[0]),a=O('"'),p=v(),_=h("div"),_.textContent="将在默认笔记本中创建新文档",d(t,"class","quick-switcher__create-icon svelte-17guwog"),d(c,"class","svelte-17guwog"),d(i,"class","quick-switcher__create-title svelte-17guwog"),d(_,"class","quick-switcher__create-hint svelte-17guwog"),d(o,"class","quick-switcher__create-content svelte-17guwog"),d(e,"class","quick-switcher__create-option svelte-17guwog"),d(e,"role","button"),d(e,"tabindex","0"),Z(e,"quick-switcher__create-option--selected",n[2]===0)},m(y,g){N(y,e,g),r(e,t),r(e,s),r(e,o),r(o,i),r(i,l),r(i,c),r(c,u),r(i,a),r(o,p),r(o,_),k||(w=[L(e,"click",n[18]),L(e,"keypress",n[19]),L(e,"mouseenter",n[20])],k=!0)},p(y,g){g[0]&1&&B(u,y[0]),g[0]&4&&Z(e,"quick-switcher__create-option--selected",y[2]===0)},d(y){y&&C(e),k=!1,ee(w)}}}function rt(n){let e,t,s,o,i,l,c,u,a,p,_;return{c(){e=h("div"),t=h("div"),t.textContent="✨",s=v(),o=h("div"),i=h("div"),l=O('创建 "'),c=h("strong"),u=O(n[0]),a=O('"'),d(t,"class","quick-switcher__create-icon svelte-17guwog"),d(c,"class","svelte-17guwog"),d(i,"class","quick-switcher__create-title svelte-17guwog"),d(o,"class","quick-switcher__create-content svelte-17guwog"),d(e,"class","quick-switcher__create-option quick-switcher__create-option--compact svelte-17guwog"),d(e,"role","button"),d(e,"tabindex","0"),Z(e,"quick-switcher__create-option--selected",n[2]===0)},m(k,w){N(k,e,w),r(e,t),r(e,s),r(e,o),r(o,i),r(i,l),r(i,c),r(c,u),r(i,a),p||(_=[L(e,"click",n[21]),L(e,"keypress",n[22]),L(e,"mouseenter",n[23])],p=!0)},p(k,w){w[0]&1&&B(u,k[0]),w[0]&4&&Z(e,"quick-switcher__create-option--selected",k[2]===0)},d(k){k&&C(e),p=!1,ee(_)}}}function at(n){let e;return{c(){e=h("span"),e.textContent="✓",d(e,"class","quick-switcher__opened-badge svelte-17guwog")},m(t,s){N(t,e,s)},d(t){t&&C(e)}}}function ut(n){let e,t=ze(n[47].path,n[0])+"";return{c(){e=h("div"),d(e,"class","quick-switcher__result-path svelte-17guwog")},m(s,o){N(s,e,o),e.innerHTML=t},p(s,o){o[0]&3&&t!==(t=ze(s[47].path,s[0])+"")&&(e.innerHTML=t)},d(s){s&&C(e)}}}function dt(n){let e,t,s=_t(n[47])+"",o,i,l,c,u,a=ze(n[47].name,n[0])+"",p,_,k,w,y,g=n[47].isOpened&&at(),m=n[47].path&&ut(n);function b(){return n[24](n[48])}function I(...D){return n[25](n[48],...D)}function E(){return n[26](n[48])}return{c(){e=h("div"),t=h("div"),o=O(s),i=v(),l=h("div"),c=h("div"),u=new Gt(!1),p=v(),g&&g.c(),_=v(),m&&m.c(),k=v(),d(t,"class","quick-switcher__result-icon svelte-17guwog"),u.a=p,d(c,"class","quick-switcher__result-title svelte-17guwog"),d(l,"class","quick-switcher__result-content svelte-17guwog"),d(e,"class","quick-switcher__result-item svelte-17guwog"),d(e,"role","button"),d(e,"tabindex","0"),Z(e,"quick-switcher__result-item--selected",n[48]===n[2]),Z(e,"quick-switcher__result-item--opened",n[47].isOpened)},m(D,P){N(D,e,P),r(e,t),r(t,o),r(e,i),r(e,l),r(l,c),u.m(a,c),r(c,p),g&&g.m(c,null),r(l,_),m&&m.m(l,null),r(e,k),w||(y=[L(e,"click",b),L(e,"keypress",I),L(e,"mouseenter",E)],w=!0)},p(D,P){n=D,P[0]&2&&s!==(s=_t(n[47])+"")&&B(o,s),P[0]&3&&a!==(a=ze(n[47].name,n[0])+"")&&u.p(a),n[47].isOpened?g||(g=at(),g.c(),g.m(c,null)):g&&(g.d(1),g=null),n[47].path?m?m.p(n,P):(m=ut(n),m.c(),m.m(l,null)):m&&(m.d(1),m=null),P[0]&5&&Z(e,"quick-switcher__result-item--selected",n[48]===n[2]),P[0]&2&&Z(e,"quick-switcher__result-item--opened",n[47].isOpened)},d(D){D&&C(e),g&&g.d(),m&&m.d(),w=!1,ee(y)}}}function an(n){let e,t,s,o=n[1].length>0&&ft(n);return{c(){e=h("span"),e.innerHTML=`<kbd class="svelte-17guwog">↑↓</kbd> 导航
        <kbd class="svelte-17guwog">Enter</kbd> 打开
        <kbd class="svelte-17guwog">⌘Enter</kbd> 插入日记
        <kbd class="svelte-17guwog">Alt+Enter</kbd> 插入提醒
        <kbd class="svelte-17guwog">Tab</kbd> 文档内搜索
        <kbd class="svelte-17guwog">Esc</kbd> 关闭`,t=v(),o&&o.c(),s=Ie(),d(e,"class","quick-switcher__hint svelte-17guwog")},m(i,l){N(i,e,l),N(i,t,l),o&&o.m(i,l),N(i,s,l)},p(i,l){i[1].length>0?o?o.p(i,l):(o=ft(i),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null)},d(i){i&&(C(e),C(t),C(s)),o&&o.d(i)}}}function un(n){let e,t,s,o,i,l,c,u,a,p=n[7]>0?"退出搜索":"关闭",_,k,w=n[7]===0&&n[0].trim(),y,g=w&&ht();return{c(){e=h("span"),t=h("kbd"),t.textContent="Enter",s=O(` 下一个
        `),o=h("kbd"),o.textContent="Shift+Enter",i=O(` 上一个
        `),l=h("kbd"),l.textContent="Tab",c=O(` 返回文档切换
        `),u=h("kbd"),u.textContent="Esc",a=v(),_=O(p),k=v(),g&&g.c(),y=Ie(),d(t,"class","svelte-17guwog"),d(o,"class","svelte-17guwog"),d(l,"class","svelte-17guwog"),d(u,"class","svelte-17guwog"),d(e,"class","quick-switcher__hint svelte-17guwog")},m(m,b){N(m,e,b),r(e,t),r(e,s),r(e,o),r(e,i),r(e,l),r(e,c),r(e,u),r(e,a),r(e,_),N(m,k,b),g&&g.m(m,b),N(m,y,b)},p(m,b){b[0]&128&&p!==(p=m[7]>0?"退出搜索":"关闭")&&B(_,p),b[0]&129&&(w=m[7]===0&&m[0].trim()),w?g||(g=ht(),g.c(),g.m(y.parentNode,y)):g&&(g.d(1),g=null)},d(m){m&&(C(e),C(k),C(y)),g&&g.d(m)}}}function ft(n){let e,t=n[1].length+"",s,o;return{c(){e=h("span"),s=O(t),o=O(" 个结果"),d(e,"class","quick-switcher__count svelte-17guwog")},m(i,l){N(i,e,l),r(e,s),r(e,o)},p(i,l){l[0]&2&&t!==(t=i[1].length+"")&&B(s,t)},d(i){i&&C(e)}}}function ht(n){let e;return{c(){e=h("span"),e.textContent="未找到匹配项",d(e,"class","quick-switcher__no-results svelte-17guwog")},m(t,s){N(t,e,s)},d(t){t&&C(e)}}}function dn(n){let e,t,s,o=n[5]?"📝":"🔍",i,l,c,u,a,p,_,k,w,y=n[4]&&it(),g=n[5]&&n[7]>0&&lt(n),m=!n[5]&&ct(n);return{c(){e=h("div"),t=h("div"),s=h("div"),i=O(o),l=v(),c=h("input"),a=v(),y&&y.c(),p=v(),g&&g.c(),_=v(),m&&m.c(),d(s,"class","quick-switcher__input-icon svelte-17guwog"),d(c,"class","quick-switcher__input svelte-17guwog"),d(c,"placeholder",u=n[5]?"在当前文档中搜索...":"输入以切换或创建文件..."),d(c,"type","text"),d(c,"spellcheck","false"),d(c,"autocomplete","off"),d(t,"class","quick-switcher__input-wrapper svelte-17guwog"),d(e,"class","quick-switcher svelte-17guwog"),d(e,"role","dialog"),d(e,"aria-modal","true"),Z(e,"quick-switcher--doc-search",n[5])},m(b,I){N(b,e,I),r(e,t),r(t,s),r(s,i),r(t,l),r(t,c),n[16](c),G(c,n[0]),r(t,a),y&&y.m(t,null),r(t,p),g&&g.m(t,null),r(e,_),m&&m.m(e,null),k||(w=[L(c,"input",n[17]),L(c,"input",n[8])],k=!0)},p(b,I){I[0]&32&&o!==(o=b[5]?"📝":"🔍")&&B(i,o),I[0]&32&&u!==(u=b[5]?"在当前文档中搜索...":"输入以切换或创建文件...")&&d(c,"placeholder",u),I[0]&1&&c.value!==b[0]&&G(c,b[0]),b[4]?y||(y=it(),y.c(),y.m(t,p)):y&&(y.d(1),y=null),b[5]&&b[7]>0?g?g.p(b,I):(g=lt(b),g.c(),g.m(t,null)):g&&(g.d(1),g=null),b[5]?m&&(m.d(1),m=null):m?m.p(b,I):(m=ct(b),m.c(),m.m(e,null)),I[0]&32&&Z(e,"quick-switcher--doc-search",b[5])},i:he,o:he,d(b){b&&C(e),n[16](null),y&&y.d(),g&&g.d(),m&&m.d(),k=!1,ee(w)}}}function pt(){const n=document.querySelector(".quick-switcher__result-item--selected");n==null||n.scrollIntoView({block:"nearest",behavior:"smooth"})}function _t(n){return n.icon&&n.icon!=="📄"?n.icon:"📄"}function fn(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function de(n){const e=document.createElement("div");e.className="quick-switcher__toast",e.textContent=n,document.body.appendChild(e),setTimeout(()=>{e.classList.add("quick-switcher__toast--hide"),setTimeout(()=>e.remove(),300)},2e3)}function hn(n,e,t){let{plugin:s}=e,{onClose:o}=e,{settings:i}=e,{onModeChange:l=()=>{}}=e,c,u,a="",p=[],_=0,k,w=!1,y=new Set,g=null,m=!1,b=0,I=0,E=[];Lt(async()=>{u=new jt(s),c=new on(s),k==null||k.focus(),await D();try{const f=await u.getOpenedDocuments();t(1,p=f)}catch(f){console.error("加载已打开文档失败:",f),t(1,p=[])}window.addEventListener("keydown",De)}),Ut(()=>{g&&clearTimeout(g),window.removeEventListener("keydown",De),pe()});async function D(){y=u.getOpenedDocIds()}async function P(){t(2,_=0),g&&clearTimeout(g),g=window.setTimeout(async()=>{m?Me():await ge()},200)}async function ge(){if(!a.trim()){try{const f=await u.getOpenedDocuments();t(1,p=f)}catch(f){console.error("Error loading opened documents:",f),t(1,p=[])}return}t(4,w=!0);try{const f=await u.searchDocs({keyword:a,limit:100});t(1,p=sn(f,a,y))}catch(f){console.error("Search error:",f),t(1,p=[])}finally{t(4,w=!1)}}function De(f){if(f.key==="Tab"){f.preventDefault(),me();return}if(m){switch(f.key){case"Enter":f.preventDefault(),f.shiftKey?ve():oe();break;case"Escape":f.preventDefault(),I>0?V():o();break}return}const T=a.trim(),M=T?p.length:p.length-1;switch(f.key){case"ArrowDown":f.preventDefault(),t(2,_=Math.min(_+1,M)),pt();break;case"ArrowUp":f.preventDefault(),t(2,_=Math.max(_-1,0)),pt();break;case"Enter":if(f.preventDefault(),f.altKey)He();else if(f.ctrlKey||f.metaKey)Ke();else if(T&&_===0)A();else{const z=T?_-1:_;p[z]&&W(p[z])}break;case"Escape":f.preventDefault(),o();break}}async function W(f){if(!f.id){console.error("文档 ID 为空！");return}try{await u.openDoc(f.id),o()}catch(T){console.error("打开文档时发生错误:",T)}}function te(f){t(2,_=f),p[f]&&W(p[f])}function Oe(f){t(2,_=f)}function me(){m?V():ne()}function ne(){t(5,m=!0),l(!0),requestAnimationFrame(()=>{t(1,p=[]),a.trim()&&requestAnimationFrame(()=>{Me()})})}function V(){t(5,m=!1),l(!1),requestAnimationFrame(()=>{t(0,a=""),requestAnimationFrame(()=>{pe(),D().then(()=>{u.getOpenedDocuments().then(f=>{t(1,p=f)})})})})}function Me(){if(!a.trim()){pe();return}try{pe();const f=document.querySelectorAll(".protyle:not(.fn__none)");if(f.length===0){console.warn("没有找到活动的编辑器"),t(7,I=0),t(6,b=0);return}const M=f[0].querySelector(".protyle-wysiwyg");if(!M){console.warn("没有找到编辑器内容区域"),t(7,I=0),t(6,b=0);return}ke(M,a),E.length>0&&(t(6,b=0),se(0))}catch(f){console.error("文档搜索过程中发生错误:",f)}}function ke(f,T){const M=document.createTreeWalker(f,NodeFilter.SHOW_TEXT,{acceptNode:R=>{const J=R.parentElement;if(!J)return NodeFilter.FILTER_REJECT;const ae=J.tagName.toLowerCase();return ae==="script"||ae==="style"||J.classList.contains("doc-search-highlight")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),z=[];let Y;for(;Y=M.nextNode();)z.push(Y);z.forEach(R=>{const J=R.textContent||"",ae=new RegExp(fn(T),"gi"),j=J.match(ae);if(j&&j.length>0){const $=R.parentElement;if(!$)return;const Le=J.split(ae),ue=document.createDocumentFragment();let qe=0;Le.forEach((_e,Je)=>{if(_e&&ue.appendChild(document.createTextNode(_e)),Je<Le.length-1&&j[qe]){const X=document.createElement("span");X.className="doc-search-highlight",X.textContent=j[qe],X.setAttribute("data-search-index",E.length.toString()),E.push(X),ue.appendChild(X),qe++}}),$.replaceChild(ue,R)}}),t(7,I=E.length)}function pe(){E.forEach(T=>{const M=T.parentElement;if(M){const z=document.createTextNode(T.textContent||"");M.replaceChild(z,T)}}),document.querySelectorAll(".protyle:not(.fn__none)").forEach(T=>{const M=T.querySelector(".protyle-wysiwyg");M&&M.normalize()}),E=[],t(7,I=0),t(6,b=0)}function se(f){if(f<0||f>=E.length)return;E.forEach(M=>{M.classList.remove("doc-search-highlight--active")});const T=E[f];T.classList.add("doc-search-highlight--active"),T.scrollIntoView({behavior:"smooth",block:"center"}),t(6,b=f)}function oe(){if(E.length===0)return;const f=(b+1)%E.length;se(f)}function ve(){if(E.length===0)return;const f=(b-1+E.length)%E.length;se(f)}async function Ke(){if(a.trim())try{await u.insertToDiary(a,i.diaryNotebook)?(de("✅ 已插入到今日日记"),t(0,a=""),setTimeout(()=>o(),500)):(console.error("❌ 插入日记失败"),de("❌ 插入日记失败"))}catch(f){console.error("插入日记时发生错误:",f),de("❌ 插入日记出错")}}async function A(){if(a.trim())try{const f=await u.getNotebooks();if(f.length===0){console.error("没有可用的笔记本");return}let T=f[0];if(i!=null&&i.defaultNotebook){const R=f.find(J=>J.id===i.defaultNotebook);R&&(T=R)}const M=a.trim(),z=`/${M}`,Y=await u.createDocument(T.id,z,M);Y?(await u.openDoc(Y),o()):console.error("文档创建失败")}catch(f){console.error("创建文档时发生错误:",f)}}async function He(){const f=a.trim();if(!f){de("⚠️ 请输入提醒标题");return}try{if(de("⏳ 正在创建提醒..."),await c.createQuickReminder(f,"none")){const M=c.getPriorityEmoji("none");de(`${M} 提醒创建成功！`),t(0,a=""),setTimeout(()=>o(),800)}else de("❌ 创建提醒失败，请检查是否安装了任务管理插件")}catch(T){console.error("创建快速提醒失败:",T),de("❌ 创建提醒失败")}}function ie(f){Xe[f?"unshift":"push"](()=>{k=f,t(3,k)})}function we(){a=this.value,t(0,a)}const Qe=()=>A(),le=f=>f.key==="Enter"&&A(),ce=()=>t(2,_=0),be=()=>A(),xe=f=>f.key==="Enter"&&A(),U=()=>t(2,_=0),re=f=>te(f),Be=(f,T)=>T.key==="Enter"&&te(f),ye=f=>Oe(f);return n.$$set=f=>{"plugin"in f&&t(12,s=f.plugin),"onClose"in f&&t(13,o=f.onClose),"settings"in f&&t(14,i=f.settings),"onModeChange"in f&&t(15,l=f.onModeChange)},[a,p,_,k,w,m,b,I,P,te,Oe,A,s,o,i,l,ie,we,Qe,le,ce,be,xe,U,re,Be,ye]}class pn extends Rt{constructor(e){super(),Pt(this,e,hn,dn,Dt,{plugin:12,onClose:13,settings:14,onModeChange:15},null,[-1,-1])}}function gt(n,e,t){const s=n.slice();return s[17]=e[t],s}function mt(n,e,t){const s=n.slice();return s[17]=e[t],s}function kt(n,e,t){const s=n.slice();return s[17]=e[t],s}function vt(n){let e,t=fe(n[0]),s=[];for(let o=0;o<t.length;o+=1)s[o]=bt(kt(n,t,o));return{c(){e=h("div");for(let o=0;o<s.length;o+=1)s[o].c();d(e,"class","settings-custom-notebooks svelte-1quvx2u")},m(o,i){N(o,e,i);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(e,null)},p(o,i){if(i&11){t=fe(o[0]);let l;for(l=0;l<t.length;l+=1){const c=kt(o,t,l);s[l]?s[l].p(c,i):(s[l]=bt(c),s[l].c(),s[l].m(e,null))}for(;l<s.length;l+=1)s[l].d(1);s.length=t.length}},d(o){o&&C(e),Ue(s,o)}}}function wt(n){let e,t,s,o,i,l=(n[17].icon||"📓")+"",c,u,a=n[17].name+"",p,_,k,w;function y(){return n[11](n[17])}return{c(){e=h("label"),t=h("input"),o=v(),i=h("span"),c=O(l),u=v(),p=O(a),_=v(),d(t,"type","checkbox"),t.checked=s=n[1].customNotebooks.includes(n[17].id),d(t,"class","svelte-1quvx2u"),d(i,"class","svelte-1quvx2u"),d(e,"class","settings-checkbox svelte-1quvx2u")},m(g,m){N(g,e,m),r(e,t),r(e,o),r(e,i),r(i,c),r(i,u),r(i,p),r(e,_),k||(w=L(t,"change",y),k=!0)},p(g,m){n=g,m&3&&s!==(s=n[1].customNotebooks.includes(n[17].id))&&(t.checked=s),m&1&&l!==(l=(n[17].icon||"📓")+"")&&B(c,l),m&1&&a!==(a=n[17].name+"")&&B(p,a)},d(g){g&&C(e),k=!1,w()}}}function bt(n){let e,t=!n[17].closed&&wt(n);return{c(){t&&t.c(),e=Ie()},m(s,o){t&&t.m(s,o),N(s,e,o)},p(s,o){s[17].closed?t&&(t.d(1),t=null):t?t.p(s,o):(t=wt(s),t.c(),t.m(e.parentNode,e))},d(s){s&&C(e),t&&t.d(s)}}}function yt(n){let e,t=(n[17].icon||"📓")+"",s,o,i=n[17].name+"",l,c,u;return{c(){e=h("option"),s=O(t),o=v(),l=O(i),c=v(),e.__value=u=n[17].id,G(e,e.__value)},m(a,p){N(a,e,p),r(e,s),r(e,o),r(e,l),r(e,c)},p(a,p){p&1&&t!==(t=(a[17].icon||"📓")+"")&&B(s,t),p&1&&i!==(i=a[17].name+"")&&B(l,i),p&1&&u!==(u=a[17].id)&&(e.__value=u,G(e,e.__value))},d(a){a&&C(e)}}}function qt(n){let e,t=!n[17].closed&&yt(n);return{c(){t&&t.c(),e=Ie()},m(s,o){t&&t.m(s,o),N(s,e,o)},p(s,o){s[17].closed?t&&(t.d(1),t=null):t?t.p(s,o):(t=yt(s),t.c(),t.m(e.parentNode,e))},d(s){s&&C(e),t&&t.d(s)}}}function St(n){let e,t=(n[17].icon||"📓")+"",s,o,i=n[17].name+"",l,c,u;return{c(){e=h("option"),s=O(t),o=v(),l=O(i),c=v(),e.__value=u=n[17].id,G(e,e.__value)},m(a,p){N(a,e,p),r(e,s),r(e,o),r(e,l),r(e,c)},p(a,p){p&1&&t!==(t=(a[17].icon||"📓")+"")&&B(s,t),p&1&&i!==(i=a[17].name+"")&&B(l,i),p&1&&u!==(u=a[17].id)&&(e.__value=u,G(e,e.__value))},d(a){a&&C(e)}}}function Et(n){let e,t=!n[17].closed&&St(n);return{c(){t&&t.c(),e=Ie()},m(s,o){t&&t.m(s,o),N(s,e,o)},p(s,o){s[17].closed?t&&(t.d(1),t=null):t?t.p(s,o):(t=St(s),t.c(),t.m(e.parentNode,e))},d(s){s&&C(e),t&&t.d(s)}}}function _n(n){let e,t,s,o,i,l,c,u,a,p,_,k,w,y,g,m,b,I,E,D,P,ge,De,W,te,Oe,me,ne,V,Me,ke,pe,se,oe,ve,Ke,A,He,ie,we,Qe,le,ce,be,xe,U,re,Be,ye,f,T,M,z,Y,R,J,ae,j,$,Le,ue,qe,_e,Je,X,Ae,Ye,We,$e,Q=n[1].searchScope==="custom"&&vt(n),Se=fe(n[0]),F=[];for(let q=0;q<Se.length;q+=1)F[q]=qt(mt(n,Se,q));let Ee=fe(n[0]),K=[];for(let q=0;q<Ee.length;q+=1)K[q]=Et(gt(n,Ee,q));return Ye=Bt(n[8][0]),{c(){e=h("div"),t=h("div"),s=h("h3"),s.textContent="搜索范围",o=v(),i=h("div"),l=h("label"),c=h("input"),u=v(),a=h("span"),a.textContent="所有笔记本",p=v(),_=h("div"),k=h("label"),w=h("input"),y=v(),g=h("span"),g.textContent="当前笔记本",m=v(),b=h("div"),I=h("label"),E=h("input"),D=v(),P=h("span"),P.textContent="自定义笔记本",ge=v(),Q&&Q.c(),De=v(),W=h("div"),te=h("h3"),te.textContent="显示设置",Oe=v(),me=h("div"),ne=h("label"),V=h("input"),Me=v(),ke=h("span"),ke.textContent="显示文档路径",pe=v(),se=h("div"),oe=h("label"),ve=h("span"),ve.textContent="最大结果数",Ke=v(),A=h("input"),He=v(),ie=h("div"),we=h("h3"),we.textContent="创建文档",Qe=v(),le=h("div"),ce=h("label"),be=h("span"),be.textContent="默认笔记本",xe=v(),U=h("select"),re=h("option"),re.textContent="第一个笔记本";for(let q=0;q<F.length;q+=1)F[q].c();Be=v(),ye=h("p"),ye.textContent="选择使用快速切换创建新文档时的默认笔记本位置",f=v(),T=h("div"),M=h("h3"),M.textContent="日记设置",z=v(),Y=h("div"),R=h("label"),J=h("span"),J.textContent="日记笔记本",ae=v(),j=h("select"),$=h("option"),$.textContent="第一个笔记本（默认）";for(let q=0;q<K.length;q+=1)K[q].c();Le=v(),ue=h("p"),ue.innerHTML="选择快速插入日记时使用的笔记本<br/> <strong>提示：</strong>按 ⌘Enter / Ctrl+Enter 可快速插入内容到今日日记",qe=v(),_e=h("div"),_e.innerHTML=`<h3 class="settings-section__title svelte-1quvx2u">快捷键</h3> <div class="settings-item svelte-1quvx2u"><p class="settings-hint svelte-1quvx2u"><strong>默认快捷键：</strong>⌘O (Mac) / Ctrl+O (Windows/Linux)<br/> <strong>自定义快捷键：</strong>请在思源笔记的 <strong>设置 → 快捷键 → 插件</strong> 中修改快捷键<br/>
        快捷键修改后即时生效，无需重启插件</p></div>`,Je=v(),X=h("div"),Ae=h("button"),Ae.textContent="保存设置",d(s,"class","settings-section__title svelte-1quvx2u"),d(c,"type","radio"),c.__value="all",G(c,c.__value),d(c,"class","svelte-1quvx2u"),d(a,"class","svelte-1quvx2u"),d(l,"class","settings-radio svelte-1quvx2u"),d(i,"class","settings-item svelte-1quvx2u"),d(w,"type","radio"),w.__value="current",G(w,w.__value),d(w,"class","svelte-1quvx2u"),d(g,"class","svelte-1quvx2u"),d(k,"class","settings-radio svelte-1quvx2u"),d(_,"class","settings-item svelte-1quvx2u"),d(E,"type","radio"),E.__value="custom",G(E,E.__value),d(E,"class","svelte-1quvx2u"),d(P,"class","svelte-1quvx2u"),d(I,"class","settings-radio svelte-1quvx2u"),d(b,"class","settings-item svelte-1quvx2u"),d(t,"class","settings-section svelte-1quvx2u"),d(te,"class","settings-section__title svelte-1quvx2u"),d(V,"type","checkbox"),d(V,"class","svelte-1quvx2u"),d(ke,"class","svelte-1quvx2u"),d(ne,"class","settings-checkbox svelte-1quvx2u"),d(me,"class","settings-item svelte-1quvx2u"),d(ve,"class","svelte-1quvx2u"),d(A,"type","number"),d(A,"min","10"),d(A,"max","200"),d(A,"class","settings-input svelte-1quvx2u"),d(oe,"class","settings-label svelte-1quvx2u"),d(se,"class","settings-item svelte-1quvx2u"),d(W,"class","settings-section svelte-1quvx2u"),d(we,"class","settings-section__title svelte-1quvx2u"),d(be,"class","svelte-1quvx2u"),re.__value="",G(re,re.__value),d(U,"class","settings-select svelte-1quvx2u"),n[1].defaultNotebook===void 0&&Fe(()=>n[14].call(U)),d(ce,"class","settings-label svelte-1quvx2u"),d(ye,"class","settings-hint svelte-1quvx2u"),d(le,"class","settings-item svelte-1quvx2u"),d(ie,"class","settings-section svelte-1quvx2u"),d(M,"class","settings-section__title svelte-1quvx2u"),d(J,"class","svelte-1quvx2u"),$.__value="",G($,$.__value),d(j,"class","settings-select svelte-1quvx2u"),n[1].diaryNotebook===void 0&&Fe(()=>n[15].call(j)),d(R,"class","settings-label svelte-1quvx2u"),d(ue,"class","settings-hint svelte-1quvx2u"),d(Y,"class","settings-item svelte-1quvx2u"),d(T,"class","settings-section svelte-1quvx2u"),d(_e,"class","settings-section svelte-1quvx2u"),d(Ae,"class","b3-button b3-button--primary svelte-1quvx2u"),d(X,"class","settings-actions svelte-1quvx2u"),d(e,"class","settings-panel svelte-1quvx2u"),Ye.p(c,w,E)},m(q,x){N(q,e,x),r(e,t),r(t,s),r(t,o),r(t,i),r(i,l),r(l,c),c.checked=c.__value===n[1].searchScope,r(l,u),r(l,a),r(t,p),r(t,_),r(_,k),r(k,w),w.checked=w.__value===n[1].searchScope,r(k,y),r(k,g),r(t,m),r(t,b),r(b,I),r(I,E),E.checked=E.__value===n[1].searchScope,r(I,D),r(I,P),r(t,ge),Q&&Q.m(t,null),r(e,De),r(e,W),r(W,te),r(W,Oe),r(W,me),r(me,ne),r(ne,V),V.checked=n[1].showPath,r(ne,Me),r(ne,ke),r(W,pe),r(W,se),r(se,oe),r(oe,ve),r(oe,Ke),r(oe,A),G(A,n[1].maxResults),r(e,He),r(e,ie),r(ie,we),r(ie,Qe),r(ie,le),r(le,ce),r(ce,be),r(ce,xe),r(ce,U),r(U,re);for(let S=0;S<F.length;S+=1)F[S]&&F[S].m(U,null);Ge(U,n[1].defaultNotebook,!0),r(le,Be),r(le,ye),r(e,f),r(e,T),r(T,M),r(T,z),r(T,Y),r(Y,R),r(R,J),r(R,ae),r(R,j),r(j,$);for(let S=0;S<K.length;S+=1)K[S]&&K[S].m(j,null);Ge(j,n[1].diaryNotebook,!0),r(Y,Le),r(Y,ue),r(e,qe),r(e,_e),r(e,Je),r(e,X),r(X,Ae),We||($e=[L(c,"change",n[7]),L(w,"change",n[9]),L(E,"change",n[10]),L(V,"change",n[12]),L(A,"input",n[13]),L(U,"change",n[14]),L(j,"change",n[15]),L(Ae,"click",n[2])],We=!0)},p(q,[x]){if(x&3&&(c.checked=c.__value===q[1].searchScope),x&3&&(w.checked=w.__value===q[1].searchScope),x&3&&(E.checked=E.__value===q[1].searchScope),q[1].searchScope==="custom"?Q?Q.p(q,x):(Q=vt(q),Q.c(),Q.m(t,null)):Q&&(Q.d(1),Q=null),x&3&&(V.checked=q[1].showPath),x&3&&Ot(A.value)!==q[1].maxResults&&G(A,q[1].maxResults),x&1){Se=fe(q[0]);let S;for(S=0;S<Se.length;S+=1){const Pe=mt(q,Se,S);F[S]?F[S].p(Pe,x):(F[S]=qt(Pe),F[S].c(),F[S].m(U,null))}for(;S<F.length;S+=1)F[S].d(1);F.length=Se.length}if(x&3&&Ge(U,q[1].defaultNotebook),x&1){Ee=fe(q[0]);let S;for(S=0;S<Ee.length;S+=1){const Pe=gt(q,Ee,S);K[S]?K[S].p(Pe,x):(K[S]=Et(Pe),K[S].c(),K[S].m(j,null))}for(;S<K.length;S+=1)K[S].d(1);K.length=Ee.length}x&3&&Ge(j,q[1].diaryNotebook)},i:he,o:he,d(q){q&&C(e),Q&&Q.d(),Ue(F,q),Ue(K,q),Ye.r(),We=!1,ee($e)}}}function gn(n,e,t){let{plugin:s}=e,{settings:o}=e,{onSave:i}=e,l,c=[],u={...o};Lt(async()=>{l=new jt(s),t(0,c=await l.getNotebooks())});function a(){i(u)}function p(D){u.customNotebooks.indexOf(D)>-1?t(1,u.customNotebooks=u.customNotebooks.filter(ge=>ge!==D),u):t(1,u.customNotebooks=[...u.customNotebooks,D],u)}const _=[[]];function k(){u.searchScope=this.__value,t(1,u),t(0,c)}function w(){u.searchScope=this.__value,t(1,u),t(0,c)}function y(){u.searchScope=this.__value,t(1,u),t(0,c)}const g=D=>p(D.id);function m(){u.showPath=this.checked,t(1,u),t(0,c)}function b(){u.maxResults=Ot(this.value),t(1,u),t(0,c)}function I(){u.defaultNotebook=tt(this),t(1,u),t(0,c)}function E(){u.diaryNotebook=tt(this),t(1,u),t(0,c)}return n.$$set=D=>{"plugin"in D&&t(4,s=D.plugin),"settings"in D&&t(5,o=D.settings),"onSave"in D&&t(6,i=D.onSave)},[c,u,a,p,s,o,i,k,_,w,y,g,m,b,I,E]}class mn extends Rt{constructor(e){super(),Pt(this,e,gn,_n,Dt,{plugin:4,settings:5,onSave:6})}}const Tt="quick-switch-settings",Ct={searchScope:"all",customNotebooks:[],maxResults:50,showPath:!0,defaultNotebook:"",diaryNotebook:""};class kn extends Ht.Plugin{constructor(){super(...arguments);H(this,"quickSwitcherInstance",null);H(this,"quickSwitcherContainer",null);H(this,"maskElement",null);H(this,"settings",Ct)}async onload(){await this.loadSettings(),this.registerCommand(),this.addTopBarIcon()}registerCommand(){this.addCommand({langKey:"openQuickSwitcher",hotkey:"⌘O",callback:()=>{this.showQuickSwitcher()}})}onunload(){this.hideQuickSwitcher()}async loadSettings(){try{const t=await this.loadData(Tt);t&&(this.settings={...Ct,...t})}catch(t){console.error("Failed to load settings:",t)}}async saveSettings(){try{await this.saveData(Tt,this.settings)}catch(t){console.error("Failed to save settings:",t)}}addTopBarIcon(){const s=this.addTopBar({icon:"iconSearch",title:"快速切换",position:"right",callback:()=>{this.showQuickSwitcher()}}).querySelector("svg");s&&(s.outerHTML='<span style="font-size: 18px; line-height: 1;">⚡</span>')}showQuickSwitcher(){if(this.quickSwitcherInstance){this.hideQuickSwitcher();return}this.maskElement=document.createElement("div"),this.maskElement.className="quick-switcher-mask",this.maskElement.addEventListener("click",()=>{this.hideQuickSwitcher()}),document.body.appendChild(this.maskElement),this.quickSwitcherContainer=document.createElement("div"),this.quickSwitcherContainer.className="quick-switcher-container",document.body.appendChild(this.quickSwitcherContainer),this.quickSwitcherInstance=new pn({target:this.quickSwitcherContainer,props:{plugin:this,settings:this.settings,onClose:()=>{this.hideQuickSwitcher()},onModeChange:t=>{var s,o;t?(s=this.maskElement)==null||s.classList.remove("quick-switcher-mask--visible"):(o=this.maskElement)==null||o.classList.add("quick-switcher-mask--visible")}}}),requestAnimationFrame(()=>{var t,s;(t=this.maskElement)==null||t.classList.add("quick-switcher-mask--visible"),(s=this.quickSwitcherContainer)==null||s.classList.add("quick-switcher-container--visible")})}hideQuickSwitcher(){var t,s;this.quickSwitcherInstance&&((t=this.maskElement)==null||t.classList.remove("quick-switcher-mask--visible"),(s=this.quickSwitcherContainer)==null||s.classList.remove("quick-switcher-container--visible"),setTimeout(()=>{this.quickSwitcherInstance&&(this.quickSwitcherInstance.$destroy(),this.quickSwitcherInstance=null),this.quickSwitcherContainer&&(this.quickSwitcherContainer.remove(),this.quickSwitcherContainer=null),this.maskElement&&(this.maskElement.remove(),this.maskElement=null)},200))}openSetting(){const t=document.createElement("div");t.className="b3-dialog b3-dialog--open",t.style.zIndex="310",t.innerHTML=`
      <div class="b3-dialog__scrim" data-close="true" style="z-index: 310;"></div>
      <div class="b3-dialog__container" style="max-width: 720px; z-index: 311;">
        <div class="b3-dialog__header" style="padding: 12px 16px;">
          <div class="b3-dialog__title" style="font-size: 16px;">快速切换 - 设置</div>
          <span class="b3-dialog__close" data-close="true" style="width: 28px; height: 28px; padding: 4px;">
            <svg style="width: 20px; height: 20px;"><use xlink:href="#iconClose"></use></svg>
          </span>
        </div>
        <div class="b3-dialog__content" id="quick-switch-settings-container" style="max-height: calc(100vh - 120px); overflow-y: auto;"></div>
      </div>
    `,document.body.appendChild(t);const s=t.querySelector("#quick-switch-settings-container");s&&new mn({target:s,props:{plugin:this,settings:this.settings,onSave:async o=>{this.settings=o,await this.saveSettings(),this.showMessage("设置已保存"),setTimeout(()=>{t.remove()},1500)}}}),t.querySelectorAll("[data-close]").forEach(o=>{o.addEventListener("click",()=>{t.remove()})})}showMessage(t,s=3e3){const o=document.createElement("div");o.className="b3-snackbar b3-snackbar--show",o.innerHTML=`
      <div class="b3-snackbar__content">${t}</div>
    `,document.body.appendChild(o),setTimeout(()=>{o.classList.remove("b3-snackbar--show"),setTimeout(()=>o.remove(),300)},s)}}module.exports=kn;
